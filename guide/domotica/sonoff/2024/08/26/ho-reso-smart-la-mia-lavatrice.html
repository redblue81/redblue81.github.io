<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Ho reso smart la mia lavatrice! - RedBlue&#39;s Blog
    
  </title>

  <meta name="description" content="Qualche tempo fa mia moglie mi ha chiesto un modo per sapere quando la lavatrice termina il lavaggio. Viviamo in una casa a più piani, e spesso non siamo nei...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://red-blue.it/guide/domotica/sonoff/2024/08/26/ho-reso-smart-la-mia-lavatrice.html">
  <link rel="alternate" type="application/rss+xml" title="RedBlue&#39;s Blog" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">RedBlue&#39;s Blog</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
		    <li class="nav-item">
          <a class="nav-link" href="/domotica">Domotica</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contacts</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->

<header class="masthead" style="background-image: url('/assets/images/smart-home-3096219_1920-768x512.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Ho reso smart la mia lavatrice!</h1>
            
            <span class="meta">Posted by
              <a href="#">RedBlue</a>
              on August 26, 2024 &middot; <span class="reading-time" title="Estimated read time">
  
   6 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p>Qualche tempo fa mia moglie mi ha chiesto un modo per sapere quando la lavatrice termina il lavaggio. Viviamo in una casa a più piani, e spesso non siamo nei pressi della lavatrice quando termina il lavaggio, ed ecco che dimenticarsi del tutto del bucato da stendere era diventato una problema.</p>

<p>Escludendo la possibilità di acquistare una modernissima lavatrice nuova, ho cercato in rete qualche progetto che fosse utile al mio scopo, ma non mi andava (e non so nemmeno se sarei stato capace) di saldare/modificare nulla sulla scheda madre, perciò ho cercato una soluzione software.</p>

<p>L’accoppiata <strong>Sonoff POW Origin + Home Assistant</strong> ha risolto tutto.</p>

<p>Il <a href="https://amzn.to/49q2ORk" target="_blank">Sonoff POW Origin</a> è una classico switch domotico, un dispositivo capace cioè di funzionare come un interruttore, ma pilotabile da smartphone (mediante app), integrabile con gli assistenti vocali, ma soprattutto capace di misurare i <strong>consumi</strong> del carico elettrico a cui è collegato.</p>

<p>Ed ecco l’idea.. Se posso monitorare i consumi della mia lavatrice, posso capire quando è <strong>attiva</strong> (cioè quando il lavaggio è in corso), e di conseguenza anche quando il lavaggio <strong>termina</strong> (se prima ha un certo consumo e poi va a zero, vuol dire che ha terminato).</p>

<p>Detto fatto, ho acquistato un <strong>POW Origin</strong>, l’ho collegato a due spezzoni di cavo elettrico della giusta sezione per un carico come una lavatrice (il classico 3x2,5mm va benissimo). Il collegamento del dispositivo è assolutamente semplice, di fatto vanno collegati il <em>neutro</em> (di solito un cavo di colore blu) e la <em>fase</em> (un cavo di colore solitamente nero o marrone) provenienti dalla linea di casa, rispettivamente su uno dei due morsetti contrassegnati con N (sono in parallelo, quindi è indifferente su quali dei due lo collegate) e su Lin (fase in ingresso); nel mio caso, ho collegato uno spezzone di cavo come indicato e poi all’altro estremo ho messo una spina che andrà in una comune presa elettrica (ho usato una cosiddetta Schuko), mentre l’altro spezzone di cavo, quello che andrà al carico (la lavatrice), va collegato allo stesso modo, ma con la fase su Lout (fase in uscita), ovviamente poi ho completato il mio cavo con una spina femmina (da collegare nel mio caso alla lavatrice).</p>

<p>A questo punto, basta configurare il dispositivo nell’app <strong>eWelink</strong> e siamo già in grado di dare/togliere corrente alla lavatrice, e soprattutto misurarne il consumo.</p>

<p>Benissimo.. Ma la notifica di fine lavaggio? La logica è chiara e non è nulla di speciale, per realizzarla ho utilizzato il <a href="https://red-blue.it/guide/linux/in%20evidenza/raspberry%20pi/domotica/2021/05/26/realizzare-il-proprio-sistema-domotico-introduzione.html" target="_blank">mini server domotico</a> che ho in casa (utilizzato molto meno di quanto avessi previsto in origine, devo ammetterlo), il quale può tranquillamente interfacciarsi tanto con i dispositivi di casa Sonoff, quanto con i più comuni assistenti vocali (nel mio caso Amazon Alexa). Avevo iniziato a buttar giù qualcosa, quando mi sono imbattutto in <a href="https://www.vincenzocaputo.com/guide/la-lavatrice-ha-finito-con-home-assistant-te-lo-facciamo-notificare-174" target="_blank">questo post</a> sul blog di Vincenzo Caputo che praticamente mi ha risolto il problema al volo! Davvero <strong>fantastico</strong>, non posso fare altro che ringraziarli!</p>

<p>Quindi, esattamente come suggerito, cominciamo con l’indicare al sistema che deve considerare i <strong>packages</strong> all’interno dell’apposita directory (se non esiste, createla nello stesso percorso del file configuration.yaml):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">homeassistant:
  packages: <span class="o">!</span>include_dir_named packages</code></pre></figure>

<p>E all’interno della suddetta directory, va inserito il seguente script, che personalmente ho battezzato <em>washingmachineintegration.yaml</em>:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">######################################################</span>
<span class="c">####################AUTOMATION########################</span>
<span class="c">######################################################</span>
automation:
- <span class="nb">id</span>: lavatrice_on
  <span class="nb">alias</span>: lavatrice on
  trigger:
  -  entity_id: sensor.lavatrice_power
     platform: numeric_state
     above: <span class="s1">'50.0'</span>
     <span class="k">for</span>:
       minutes: 1
  action:
  - service: input_boolean.turn_on
    entity_id: input_boolean.lavatrice_switch 

- <span class="nb">id</span>: lavatrice_fine_switch_state
  <span class="nb">alias</span>: Lavatrice fine switch state
  trigger: 
  - entity_id: sensor.lavatrice_power
    platform: numeric_state
    below: <span class="s1">'5.0'</span>
    <span class="k">for</span>:
      minutes: 1
  condition:
  - condition: state
    entity_id: <span class="s1">'input_boolean.lavatrice_switch'</span>
    state: <span class="s1">'on'</span>
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.lavatrice_switch

- <span class="nb">id</span>: lavatrice_done
  <span class="nb">alias</span>: Lavatrice Finito
  trigger:
  - entity_id: input_boolean.lavatrice_switch
    platform: state
    to: <span class="s1">'off'</span>
  action:
  - service: notify.alexa_media
    data:
      message: La lavatrice ha terminato il lavaggio. Ricordati di stendere il bucato
      target: media_player.nome_primo_dispositivo_alexa
      data:
        <span class="nb">type</span>: announce  
  - service: notify.alexa_media
    data:
      message: La lavatrice ha terminato il lavaggio. Ricordati di stendere il bucato
      target: media_player.nome_secondo_dispositivo_alexa
      data:
        <span class="nb">type</span>: announce
<span class="c">########################################################</span>
<span class="c">################INPUT_BOOLEAN############################</span>
<span class="c">########################################################</span>
input_boolean:
  lavatrice_switch:
    name: stato del lavaggio
    initial: off
    icon: mdi:washing-machine</code></pre></figure>

<p>Si tratta dello script presente al post di cui sopra, che ho adattato alle mie esigenze, ovvero al fatto che volevo che Alexa mi annunciasse la fine del lavaggio. Inoltre, l’ho anche adattato ai consumi della mia lavatrice.</p>

<p>Il cuore è in pratica l’<strong>INPUT_BOOLEAN</strong> che si trova alla fine, che switchando tra off e on “fa capire” ad Home Assistant se deve partire o meno l’automazione che chiama l’annuncio di fine bucato: nel mio caso, se rileva un consumo di almeno 50 watt per almeno 1 minuto, switcha ad on (lavatrice in funzione), al contrario se rileva un consumo di meno di 5 watt per almeno 1 minuto, switcha ad off (la lavatrice ha terminato). In quest’ultimo caso, cioè se si verifica <strong>lo switch da on ad off</strong>, parte il “Lavatrice finito”, che fa scattare a sua volta l’annuncio.</p>

<p>Ovviamente quel <em>sensor.lavatrice_power</em> altro non è che il “sensore” relativo al Sonoff POW Origin che ho rinominato in questo modo.</p>

<p>Per gestire dispositivi Sonoff in Home Assistant, basta installare l’integrazione <strong>Sonoff LAN</strong> da HACS, la quale riconoscera in maniera pressochè istantanea qualsiasi dispositivo di casa Sonoff presente nella vostra rete. Per usare Alexa come media player e riprodurre gli annunci, potete seguire <a href="https://red-blue.it/guide/domotica/alexa/2024/08/20/annunci-da-alexa-tramite-home-assistant.html" target="_blank">questo post</a>.</p>

<p>Semplice e geniale!</p>

<p>Stay tuned..</p>

<p>Credits: <a href="https://www.vincenzocaputo.com/guide/la-lavatrice-ha-finito-con-home-assistant-te-lo-facciamo-notificare-174" target="_blank">Vincenzo Caputo</a></p>


        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/guide/blog/ruby/jekyll/2024/08/24/schedulare-la-pubblicazione-dei-post-su-github-pages-con-jekyll.html" data-toggle="tooltip" data-placement="top" title="Schedulare la pubblicazione dei post su Github Pages con Jekyll">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/guide/domotica/sonoff/2024/09/22/soluzione-RPC-failed-curl-92-HTTP-2-stream-0-was-not-closed-cleanly-CANCEL-err-8.html" data-toggle="tooltip" data-placement="top" title="Soluzione errore RPC failed; curl 92 HTTP/2 stream 0 was not closed cleanly CANCEL (err 8)">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:redblue81@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.facebook.com/angeloredbluepascadopoli">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/angelopascadopoli">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://instagram.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; RedBlue 2025</p>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVMQV0LE9M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LVMQV0LE9M');
</script>

</body>

</html>
