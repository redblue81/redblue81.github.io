<!DOCTYPE html>

<html>

<head>

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Domotica - Integrare Home Assistant con Alexa | RedBlue’s Blog</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Domotica - Integrare Home Assistant con Alexa" />
<meta name="author" content="RedBlue" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Oggi vediamo come integrare Home Assistant con Alexa. Finora abbiamo un sistema controllabile unicamente dall&#39;interfaccia del PC o dall&#39;app, ma la possibilit&agrave; di usare tutto solo con la voce non pu&ograve; essere trascurata. Diciamo subito che esistono almeno due modi di realizzare questa integrazione: il primo, pi&ugrave; semplice, prevede di far apparire tutto come fosse una lampadina, il secondo invece prevede una vera e propria integrazione mediante una skill realizzata apposta. Ho scelto il secondo metodo, all&#39;apparenza molto complesso, ma in realt&agrave; vedremo come integrare Home Assistant con Alexa sia pi&ugrave; semplice del previsto, basta procedere con calma e seguire le istruzioni che scriver&ograve;. Premessa: &egrave; necessario che Home Assistant sia raggiungibile dall&#39;esterno. Primo passo. Iniziamo col creare un token di accesso a lunga vita dal menu relativo al nostro utente (in basso a sinistra), baster&agrave; crearlo, indicare un nome e copiarlo da qualche parte, servir&agrave; successivamente. Secondo passo, editiamo il file configuration.yaml ed inseriamo le seguenti righe di codice: alexa: smart_home: filter: include_domains: - light In questo modo stiamo indicando che useremo solo il dominio lights, ovvero controlleremo con Alexa solo le luci (ma ovviamente possiamo estendere il tutto in un secondo momento a qualsiasi dominio consentito). Adesso &egrave; il momento di iscriverci alla Developer Console di Amazon, baster&agrave; loggarsi in questa pagina col proprio account Amazon, cliccare su Developer Console (in alto a destra) e creare un Nuovo profilo di Sicurezza cliccando su Impostazioni -&gt; Profili di sicurezza, assegnamo come nome ad esempio Domotica e come descrizione scegliamo Dialogo tra Home Assistant e Alexa, infine salviamo. Ora &egrave; il momento di creare un account su Amazon Web Services, dovremo registrarci con un account non professionale, inserendo i dati di una carta di credito (necessari per la verifica dell&#39;identit&agrave;) dalla quale verr&agrave; prelevata una piccola somma (poi restituita). Ovviamente, l&#39;uso che faremo di questo account non preveder&agrave; alcun pagamento in futuro. Dopo la registrazione, andiamo sulla console, clicchiamo a sinistra su Ruoli e poi su Crea ruolo. A questo punto scegliamo Servizio AWS, nella stessa pagina clicchiamo su Lambda e vedremo in basso a destra abilitarsi il pulsante Successivo: Autorizzazioni, sul quale dovremo cliccare. Nella successiva schermata, selezionare AWSLambdaBasicExecutionRole (se non &egrave; immediatamente visualizzato basta cercarlo nel box in cima all&#39;elenco), poi cliccare su Successivo: Tag. Nella successiva schermata non c&#39;&egrave; bisogno di modificare alcunch&egrave;, si pu&ograve; direttamente cliccare in basso su Successivo: Verifica. A questo punto, inseriamo come nome ruolo AWSLambdaBasicExecutionRole-SmartHome, lasciando pure vuota la descrizione e clicchiamo finalmente su Crea Ruolo. Ci siamo quasi, &egrave; il momento di creare la funzione che permette di integrare Home Assistant con Alexa! Andiamo nella dashboard relativa alle funzioni e clicchiamo su Crea Funzione. Proseguiamo con Crea da zero e inseriamo un nome (Domotica), scegliamo Python 3.8 come linguaggio, in Modifica del ruolo di esecuzione predefinito scegliamo Utilizza un ruolo esistente e selezioniamo quello creato in precedenza. Clicchiamo su Crea Funzione. A questo punto raggiungiamo questa pagina, clicchiamo su Crea Skill, assegnamo un nome, scegliamo Italiano come lingua, Smart Home come Model e infine Provision your own. In alto a destra c&#39;&egrave; il pulsante Create skill. Nella successiva schermata scegliamo (se non gi&agrave; selezionata) la versione 3 del payload e copiate da qualche parte lo skill-ID che trovate subito sotto. Possiamo tornare sulla dashboard delle funzioni che abbiamo visto in precedenza e selezionare la funzione Domotica (se l&#39;avete chiamata cos&igrave;), clicchiamo poi su Aggiungi trigger e selezioniamo nella schermata successiva Alexa Smart Home, inserendo come ID Applicazione lo skill-ID che abbiamo copiato al passo precedente, infine clicchiamo su Aggiungi. Torneremo indietro di una schermata, basta cliccare su Domotica (vedremo un&#39;icona arancione a sinistra) e in basso, nella scheda Codice, bisogner&agrave; cancellare quello che viene proposto e copiare il codice che si trova in questa pagina. Clicchiamo su File -&gt; Salva e poi su Deploy (si trova tutto nella scheda Codice), poi andiamo nella scheda Configurazione -&gt; Modifica -&gt; Aggiungi Variabili d&#39;ambiente. Dovremo aggiungere le seguenti 4 variabili: BASE_URL: https://nomedominio.duckdns.org DEBUG: True NOT_VERIFY_SSL: True LONG_LIVED_ACCESS_TOKEN: il token creato inizialmente su Home Assistant Attenzione perch&egrave; ad ogni variabile occorre cliccare su Aggiungi variabile d&#39;ambiente. Salviamo il tutto e clicchiamo su Copia ARN in alto a destra, mettiamo da parte anche questo codice che ci servir&agrave; a breve. Testiamo ora il tutto, basta cliccare su Test -&gt; Configure test event -&gt; Crea un nuovo evento di test. Diamo un nome e inseriamo le seguenti righe di codice: { &quot;directive&quot;: { &quot;header&quot;: { &quot;namespace&quot;: &quot;Alexa.Discovery&quot;, &quot;name&quot;: &quot;Discover&quot;, &quot;payloadVersion&quot;: &quot;3&quot;, &quot;messageId&quot;: &quot;1bd5d003-31b9-476f-ad03-71d471922820&quot; }, &quot;payload&quot;: { &quot;scope&quot;: { &quot;type&quot;: &quot;BearerToken&quot; } } } } Clicchiamo su Crea, poi su Test. Se tutto &egrave; andato bene, la risposta sar&agrave; affermativa. Torniamo adesso alla console di AWS, selezionando la skill creata in precedenza. Come Default Endpoint occorre inserire il codice ARN copiato in precedenza. Salviamo e poi clicchiamo su Setup Account Linking in basso, nella schermata successiva compiliamo i campi come segue: Your Web Authorization URI: https://nomedominio.duckdns.org/auth/authorize Access Token URI: https://nomedominio.duckdns.org/auth/token Your Client ID: https://layla.amazon.com Client Secret: Home Assistant HDJ Your Authentication Scheme: Credentials in request body Scope: cliccate su add scope e inserite smart_home Lasciate invariato il resto e cliccate su Save. A questo punto per integrare Home Assistant con Alexa non resta che collegare il tutto all&#39;app Alexa! Andiamo in questa pagina, facciamo il login con le credenziali del nostro dispositivo Alexa, poi su Skill -&gt; Le tue skill -&gt; Skill per sviluppatori: dovremmo vedere la skill Domotica che abbiamo creato e, cliccando su Attiva, dovrebbe segnalare che la skill &egrave; collegata con successo. Andando infine su Scopri i dispositivi dovrebbero magicamente apparire in lista tutti i dispositivi (per ora solo le luci, ve lo ricordo) gestiti da Home Assistant! Se tutto &egrave; andato bene, siamo riusciti ad integrare Home Assistant con Alexa. Non resta che limare la configurazione creata per aumentare la sicurezza, torniamo in questa pagina, e cancelliamo le due variabili d&#39;ambiente DEBUG e LONG_LIVED_ACCESS_TOKEN create in precedenza, non serviranno ulteriormente. Il token di accesso a lunga vita a questo punto pu&ograve; essere cancellato anche da Home Assistant. So che integrare Home Assistant con Alexa pu&ograve; sembrare un processo piuttosto complesso, ma seguendo il tutto con calma vi assicuro che il risultato &egrave; estremamente soddisfacente. Alla prossima.." />
<meta property="og:description" content="Oggi vediamo come integrare Home Assistant con Alexa. Finora abbiamo un sistema controllabile unicamente dall&#39;interfaccia del PC o dall&#39;app, ma la possibilit&agrave; di usare tutto solo con la voce non pu&ograve; essere trascurata. Diciamo subito che esistono almeno due modi di realizzare questa integrazione: il primo, pi&ugrave; semplice, prevede di far apparire tutto come fosse una lampadina, il secondo invece prevede una vera e propria integrazione mediante una skill realizzata apposta. Ho scelto il secondo metodo, all&#39;apparenza molto complesso, ma in realt&agrave; vedremo come integrare Home Assistant con Alexa sia pi&ugrave; semplice del previsto, basta procedere con calma e seguire le istruzioni che scriver&ograve;. Premessa: &egrave; necessario che Home Assistant sia raggiungibile dall&#39;esterno. Primo passo. Iniziamo col creare un token di accesso a lunga vita dal menu relativo al nostro utente (in basso a sinistra), baster&agrave; crearlo, indicare un nome e copiarlo da qualche parte, servir&agrave; successivamente. Secondo passo, editiamo il file configuration.yaml ed inseriamo le seguenti righe di codice: alexa: smart_home: filter: include_domains: - light In questo modo stiamo indicando che useremo solo il dominio lights, ovvero controlleremo con Alexa solo le luci (ma ovviamente possiamo estendere il tutto in un secondo momento a qualsiasi dominio consentito). Adesso &egrave; il momento di iscriverci alla Developer Console di Amazon, baster&agrave; loggarsi in questa pagina col proprio account Amazon, cliccare su Developer Console (in alto a destra) e creare un Nuovo profilo di Sicurezza cliccando su Impostazioni -&gt; Profili di sicurezza, assegnamo come nome ad esempio Domotica e come descrizione scegliamo Dialogo tra Home Assistant e Alexa, infine salviamo. Ora &egrave; il momento di creare un account su Amazon Web Services, dovremo registrarci con un account non professionale, inserendo i dati di una carta di credito (necessari per la verifica dell&#39;identit&agrave;) dalla quale verr&agrave; prelevata una piccola somma (poi restituita). Ovviamente, l&#39;uso che faremo di questo account non preveder&agrave; alcun pagamento in futuro. Dopo la registrazione, andiamo sulla console, clicchiamo a sinistra su Ruoli e poi su Crea ruolo. A questo punto scegliamo Servizio AWS, nella stessa pagina clicchiamo su Lambda e vedremo in basso a destra abilitarsi il pulsante Successivo: Autorizzazioni, sul quale dovremo cliccare. Nella successiva schermata, selezionare AWSLambdaBasicExecutionRole (se non &egrave; immediatamente visualizzato basta cercarlo nel box in cima all&#39;elenco), poi cliccare su Successivo: Tag. Nella successiva schermata non c&#39;&egrave; bisogno di modificare alcunch&egrave;, si pu&ograve; direttamente cliccare in basso su Successivo: Verifica. A questo punto, inseriamo come nome ruolo AWSLambdaBasicExecutionRole-SmartHome, lasciando pure vuota la descrizione e clicchiamo finalmente su Crea Ruolo. Ci siamo quasi, &egrave; il momento di creare la funzione che permette di integrare Home Assistant con Alexa! Andiamo nella dashboard relativa alle funzioni e clicchiamo su Crea Funzione. Proseguiamo con Crea da zero e inseriamo un nome (Domotica), scegliamo Python 3.8 come linguaggio, in Modifica del ruolo di esecuzione predefinito scegliamo Utilizza un ruolo esistente e selezioniamo quello creato in precedenza. Clicchiamo su Crea Funzione. A questo punto raggiungiamo questa pagina, clicchiamo su Crea Skill, assegnamo un nome, scegliamo Italiano come lingua, Smart Home come Model e infine Provision your own. In alto a destra c&#39;&egrave; il pulsante Create skill. Nella successiva schermata scegliamo (se non gi&agrave; selezionata) la versione 3 del payload e copiate da qualche parte lo skill-ID che trovate subito sotto. Possiamo tornare sulla dashboard delle funzioni che abbiamo visto in precedenza e selezionare la funzione Domotica (se l&#39;avete chiamata cos&igrave;), clicchiamo poi su Aggiungi trigger e selezioniamo nella schermata successiva Alexa Smart Home, inserendo come ID Applicazione lo skill-ID che abbiamo copiato al passo precedente, infine clicchiamo su Aggiungi. Torneremo indietro di una schermata, basta cliccare su Domotica (vedremo un&#39;icona arancione a sinistra) e in basso, nella scheda Codice, bisogner&agrave; cancellare quello che viene proposto e copiare il codice che si trova in questa pagina. Clicchiamo su File -&gt; Salva e poi su Deploy (si trova tutto nella scheda Codice), poi andiamo nella scheda Configurazione -&gt; Modifica -&gt; Aggiungi Variabili d&#39;ambiente. Dovremo aggiungere le seguenti 4 variabili: BASE_URL: https://nomedominio.duckdns.org DEBUG: True NOT_VERIFY_SSL: True LONG_LIVED_ACCESS_TOKEN: il token creato inizialmente su Home Assistant Attenzione perch&egrave; ad ogni variabile occorre cliccare su Aggiungi variabile d&#39;ambiente. Salviamo il tutto e clicchiamo su Copia ARN in alto a destra, mettiamo da parte anche questo codice che ci servir&agrave; a breve. Testiamo ora il tutto, basta cliccare su Test -&gt; Configure test event -&gt; Crea un nuovo evento di test. Diamo un nome e inseriamo le seguenti righe di codice: { &quot;directive&quot;: { &quot;header&quot;: { &quot;namespace&quot;: &quot;Alexa.Discovery&quot;, &quot;name&quot;: &quot;Discover&quot;, &quot;payloadVersion&quot;: &quot;3&quot;, &quot;messageId&quot;: &quot;1bd5d003-31b9-476f-ad03-71d471922820&quot; }, &quot;payload&quot;: { &quot;scope&quot;: { &quot;type&quot;: &quot;BearerToken&quot; } } } } Clicchiamo su Crea, poi su Test. Se tutto &egrave; andato bene, la risposta sar&agrave; affermativa. Torniamo adesso alla console di AWS, selezionando la skill creata in precedenza. Come Default Endpoint occorre inserire il codice ARN copiato in precedenza. Salviamo e poi clicchiamo su Setup Account Linking in basso, nella schermata successiva compiliamo i campi come segue: Your Web Authorization URI: https://nomedominio.duckdns.org/auth/authorize Access Token URI: https://nomedominio.duckdns.org/auth/token Your Client ID: https://layla.amazon.com Client Secret: Home Assistant HDJ Your Authentication Scheme: Credentials in request body Scope: cliccate su add scope e inserite smart_home Lasciate invariato il resto e cliccate su Save. A questo punto per integrare Home Assistant con Alexa non resta che collegare il tutto all&#39;app Alexa! Andiamo in questa pagina, facciamo il login con le credenziali del nostro dispositivo Alexa, poi su Skill -&gt; Le tue skill -&gt; Skill per sviluppatori: dovremmo vedere la skill Domotica che abbiamo creato e, cliccando su Attiva, dovrebbe segnalare che la skill &egrave; collegata con successo. Andando infine su Scopri i dispositivi dovrebbero magicamente apparire in lista tutti i dispositivi (per ora solo le luci, ve lo ricordo) gestiti da Home Assistant! Se tutto &egrave; andato bene, siamo riusciti ad integrare Home Assistant con Alexa. Non resta che limare la configurazione creata per aumentare la sicurezza, torniamo in questa pagina, e cancelliamo le due variabili d&#39;ambiente DEBUG e LONG_LIVED_ACCESS_TOKEN create in precedenza, non serviranno ulteriormente. Il token di accesso a lunga vita a questo punto pu&ograve; essere cancellato anche da Home Assistant. So che integrare Home Assistant con Alexa pu&ograve; sembrare un processo piuttosto complesso, ma seguendo il tutto con calma vi assicuro che il risultato &egrave; estremamente soddisfacente. Alla prossima.." />
<link rel="canonical" href="https://red-blue.it/guide/linux/in%20evidenza/domotica/2021/08/30/domotica-integrare-home-assistant-con-alexa.html" />
<meta property="og:url" content="https://red-blue.it/guide/linux/in%20evidenza/domotica/2021/08/30/domotica-integrare-home-assistant-con-alexa.html" />
<meta property="og:site_name" content="RedBlue’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-30T12:12:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Domotica - Integrare Home Assistant con Alexa" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"RedBlue"},"dateModified":"2021-08-30T12:12:00+00:00","datePublished":"2021-08-30T12:12:00+00:00","description":"Oggi vediamo come integrare Home Assistant con Alexa. Finora abbiamo un sistema controllabile unicamente dall&#39;interfaccia del PC o dall&#39;app, ma la possibilit&agrave; di usare tutto solo con la voce non pu&ograve; essere trascurata. Diciamo subito che esistono almeno due modi di realizzare questa integrazione: il primo, pi&ugrave; semplice, prevede di far apparire tutto come fosse una lampadina, il secondo invece prevede una vera e propria integrazione mediante una skill realizzata apposta. Ho scelto il secondo metodo, all&#39;apparenza molto complesso, ma in realt&agrave; vedremo come integrare Home Assistant con Alexa sia pi&ugrave; semplice del previsto, basta procedere con calma e seguire le istruzioni che scriver&ograve;. Premessa: &egrave; necessario che Home Assistant sia raggiungibile dall&#39;esterno. Primo passo. Iniziamo col creare un token di accesso a lunga vita dal menu relativo al nostro utente (in basso a sinistra), baster&agrave; crearlo, indicare un nome e copiarlo da qualche parte, servir&agrave; successivamente. Secondo passo, editiamo il file configuration.yaml ed inseriamo le seguenti righe di codice: alexa: smart_home: filter: include_domains: - light In questo modo stiamo indicando che useremo solo il dominio lights, ovvero controlleremo con Alexa solo le luci (ma ovviamente possiamo estendere il tutto in un secondo momento a qualsiasi dominio consentito). Adesso &egrave; il momento di iscriverci alla Developer Console di Amazon, baster&agrave; loggarsi in questa pagina col proprio account Amazon, cliccare su Developer Console (in alto a destra) e creare un Nuovo profilo di Sicurezza cliccando su Impostazioni -&gt; Profili di sicurezza, assegnamo come nome ad esempio Domotica e come descrizione scegliamo Dialogo tra Home Assistant e Alexa, infine salviamo. Ora &egrave; il momento di creare un account su Amazon Web Services, dovremo registrarci con un account non professionale, inserendo i dati di una carta di credito (necessari per la verifica dell&#39;identit&agrave;) dalla quale verr&agrave; prelevata una piccola somma (poi restituita). Ovviamente, l&#39;uso che faremo di questo account non preveder&agrave; alcun pagamento in futuro. Dopo la registrazione, andiamo sulla console, clicchiamo a sinistra su Ruoli e poi su Crea ruolo. A questo punto scegliamo Servizio AWS, nella stessa pagina clicchiamo su Lambda e vedremo in basso a destra abilitarsi il pulsante Successivo: Autorizzazioni, sul quale dovremo cliccare. Nella successiva schermata, selezionare AWSLambdaBasicExecutionRole (se non &egrave; immediatamente visualizzato basta cercarlo nel box in cima all&#39;elenco), poi cliccare su Successivo: Tag. Nella successiva schermata non c&#39;&egrave; bisogno di modificare alcunch&egrave;, si pu&ograve; direttamente cliccare in basso su Successivo: Verifica. A questo punto, inseriamo come nome ruolo AWSLambdaBasicExecutionRole-SmartHome, lasciando pure vuota la descrizione e clicchiamo finalmente su Crea Ruolo. Ci siamo quasi, &egrave; il momento di creare la funzione che permette di integrare Home Assistant con Alexa! Andiamo nella dashboard relativa alle funzioni e clicchiamo su Crea Funzione. Proseguiamo con Crea da zero e inseriamo un nome (Domotica), scegliamo Python 3.8 come linguaggio, in Modifica del ruolo di esecuzione predefinito scegliamo Utilizza un ruolo esistente e selezioniamo quello creato in precedenza. Clicchiamo su Crea Funzione. A questo punto raggiungiamo questa pagina, clicchiamo su Crea Skill, assegnamo un nome, scegliamo Italiano come lingua, Smart Home come Model e infine Provision your own. In alto a destra c&#39;&egrave; il pulsante Create skill. Nella successiva schermata scegliamo (se non gi&agrave; selezionata) la versione 3 del payload e copiate da qualche parte lo skill-ID che trovate subito sotto. Possiamo tornare sulla dashboard delle funzioni che abbiamo visto in precedenza e selezionare la funzione Domotica (se l&#39;avete chiamata cos&igrave;), clicchiamo poi su Aggiungi trigger e selezioniamo nella schermata successiva Alexa Smart Home, inserendo come ID Applicazione lo skill-ID che abbiamo copiato al passo precedente, infine clicchiamo su Aggiungi. Torneremo indietro di una schermata, basta cliccare su Domotica (vedremo un&#39;icona arancione a sinistra) e in basso, nella scheda Codice, bisogner&agrave; cancellare quello che viene proposto e copiare il codice che si trova in questa pagina. Clicchiamo su File -&gt; Salva e poi su Deploy (si trova tutto nella scheda Codice), poi andiamo nella scheda Configurazione -&gt; Modifica -&gt; Aggiungi Variabili d&#39;ambiente. Dovremo aggiungere le seguenti 4 variabili: BASE_URL: https://nomedominio.duckdns.org DEBUG: True NOT_VERIFY_SSL: True LONG_LIVED_ACCESS_TOKEN: il token creato inizialmente su Home Assistant Attenzione perch&egrave; ad ogni variabile occorre cliccare su Aggiungi variabile d&#39;ambiente. Salviamo il tutto e clicchiamo su Copia ARN in alto a destra, mettiamo da parte anche questo codice che ci servir&agrave; a breve. Testiamo ora il tutto, basta cliccare su Test -&gt; Configure test event -&gt; Crea un nuovo evento di test. Diamo un nome e inseriamo le seguenti righe di codice: { &quot;directive&quot;: { &quot;header&quot;: { &quot;namespace&quot;: &quot;Alexa.Discovery&quot;, &quot;name&quot;: &quot;Discover&quot;, &quot;payloadVersion&quot;: &quot;3&quot;, &quot;messageId&quot;: &quot;1bd5d003-31b9-476f-ad03-71d471922820&quot; }, &quot;payload&quot;: { &quot;scope&quot;: { &quot;type&quot;: &quot;BearerToken&quot; } } } } Clicchiamo su Crea, poi su Test. Se tutto &egrave; andato bene, la risposta sar&agrave; affermativa. Torniamo adesso alla console di AWS, selezionando la skill creata in precedenza. Come Default Endpoint occorre inserire il codice ARN copiato in precedenza. Salviamo e poi clicchiamo su Setup Account Linking in basso, nella schermata successiva compiliamo i campi come segue: Your Web Authorization URI: https://nomedominio.duckdns.org/auth/authorize Access Token URI: https://nomedominio.duckdns.org/auth/token Your Client ID: https://layla.amazon.com Client Secret: Home Assistant HDJ Your Authentication Scheme: Credentials in request body Scope: cliccate su add scope e inserite smart_home Lasciate invariato il resto e cliccate su Save. A questo punto per integrare Home Assistant con Alexa non resta che collegare il tutto all&#39;app Alexa! Andiamo in questa pagina, facciamo il login con le credenziali del nostro dispositivo Alexa, poi su Skill -&gt; Le tue skill -&gt; Skill per sviluppatori: dovremmo vedere la skill Domotica che abbiamo creato e, cliccando su Attiva, dovrebbe segnalare che la skill &egrave; collegata con successo. Andando infine su Scopri i dispositivi dovrebbero magicamente apparire in lista tutti i dispositivi (per ora solo le luci, ve lo ricordo) gestiti da Home Assistant! Se tutto &egrave; andato bene, siamo riusciti ad integrare Home Assistant con Alexa. Non resta che limare la configurazione creata per aumentare la sicurezza, torniamo in questa pagina, e cancelliamo le due variabili d&#39;ambiente DEBUG e LONG_LIVED_ACCESS_TOKEN create in precedenza, non serviranno ulteriormente. Il token di accesso a lunga vita a questo punto pu&ograve; essere cancellato anche da Home Assistant. So che integrare Home Assistant con Alexa pu&ograve; sembrare un processo piuttosto complesso, ma seguendo il tutto con calma vi assicuro che il risultato &egrave; estremamente soddisfacente. Alla prossima..","headline":"Domotica - Integrare Home Assistant con Alexa","mainEntityOfPage":{"@type":"WebPage","@id":"https://red-blue.it/guide/linux/in%20evidenza/domotica/2021/08/30/domotica-integrare-home-assistant-con-alexa.html"},"url":"https://red-blue.it/guide/linux/in%20evidenza/domotica/2021/08/30/domotica-integrare-home-assistant-con-alexa.html"}</script>
<!-- End Jekyll SEO tag -->


  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Domotica - Integrare Home Assistant con Alexa - RedBlue&#39;s Blog
    
  </title>

  <meta name="description" content="Oggi vediamo come integrare Home Assistant con Alexa. Finora abbiamo un sistema controllabile unicamente dall&#39;interfaccia del PC o dall&#39;app, ma la possibilit...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://red-blue.it/guide/linux/in%20evidenza/domotica/2021/08/30/domotica-integrare-home-assistant-con-alexa.html">
  <link rel="alternate" type="application/rss+xml" title="RedBlue&#39;s Blog" href="/feed.xml">

</head> 

<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">RedBlue&#39;s Blog</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
		    <li class="nav-item">
          <a class="nav-link" href="/domotica">Domotica</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contacts</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->

  <header class="masthead">
    
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Domotica - Integrare Home Assistant con Alexa</h1>
            
            <span class="meta">Posted by
              <a href="#">RedBlue</a>
              on August 30, 2021 &middot; <span class="reading-time" title="Estimated read time">
  
   9 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p><!-- wp:paragraph --></p>
<p>Oggi vediamo come <strong>integrare Home Assistant con Alexa</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><a href="http://localhost:4000/domotica" data-type="page" data-id="4071" target="_blank" rel="noreferrer noopener">Finora</a> abbiamo un sistema controllabile unicamente dall'interfaccia del PC o dall'app, ma la possibilit&agrave; di usare tutto solo con la voce non pu&ograve; essere trascurata.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Diciamo subito che esistono almeno due modi di realizzare questa integrazione: il primo, pi&ugrave; semplice, prevede di far apparire tutto come fosse una <strong>lampadina</strong>, il secondo invece prevede una vera e propria integrazione mediante una <strong>skill</strong> realizzata apposta.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Ho scelto il secondo metodo, all'apparenza molto complesso, ma in realt&agrave; vedremo come integrare Home Assistant con Alexa sia pi&ugrave; semplice del previsto, basta procedere con calma e seguire le istruzioni che scriver&ograve;.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:more --><br />
<!--more--><br />
<!-- /wp:more --></p>
<p><!-- wp:paragraph --></p>
<p><strong>Premessa</strong>: &egrave; necessario che Home Assistant sia <a rel="noreferrer noopener" href="http://localhost:4000/domotica/domotica-accedere-a-home-assistant-dallesterno.html" data-type="post" data-id="4121" target="_blank">raggiungibile dall'esterno</a>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><strong>Primo passo.</strong> Iniziamo col creare un <strong>token di accesso a lunga vita</strong> dal menu relativo al nostro utente (in basso a sinistra), baster&agrave; crearlo, indicare un nome e copiarlo da qualche parte, servir&agrave; successivamente.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><strong>Secondo passo</strong>, editiamo il file configuration.yaml ed inseriamo le seguenti righe di codice:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:syntaxhighlighter/code {"language":"yaml"} --></p>
<pre class="wp-block-syntaxhighlighter-code">alexa:
  smart_home:
    filter:
      include_domains:
        - light</pre>
<p><!-- /wp:syntaxhighlighter/code --></p>
<p><!-- wp:paragraph --></p>
<p>In questo modo stiamo indicando che useremo solo il dominio <strong>lights</strong>, ovvero controlleremo con Alexa solo le luci (ma ovviamente possiamo estendere il tutto in un secondo momento a qualsiasi dominio consentito).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Adesso &egrave; il momento di iscriverci alla <strong>Developer Console</strong> di Amazon, baster&agrave; loggarsi in <a rel="noreferrer noopener" href="https://developer.amazon.com/it/" target="_blank">questa pagina</a> col proprio account Amazon, cliccare su <strong>Developer Console</strong> (in alto a destra) e creare un <strong>Nuovo profilo di Sicurezza</strong> cliccando su <strong>Impostazioni -> Profili di sicurezza</strong>, assegnamo come nome ad esempio Domotica e come descrizione scegliamo <strong>Dialogo tra Home Assistant e Alexa</strong>, infine salviamo.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Ora &egrave; il momento di creare un account su <a href="https://aws.amazon.com/it/" target="_blank" rel="noreferrer noopener">Amazon Web Services</a>, dovremo registrarci con un account non professionale, inserendo i dati di una carta di credito (necessari per la verifica dell'identit&agrave;) dalla quale verr&agrave; prelevata una piccola somma (poi restituita). Ovviamente, l'uso che faremo di questo account <strong>non preveder&agrave;</strong> alcun pagamento in futuro.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Dopo la registrazione, andiamo sulla console, clicchiamo a sinistra su <strong>Ruoli</strong> e poi su <strong>Crea ruolo</strong>. A questo punto scegliamo <strong>Servizio AWS</strong>, nella stessa pagina clicchiamo su <strong>Lambda</strong> e vedremo in basso a destra abilitarsi il pulsante <strong>Successivo: Autorizzazioni</strong>, sul quale dovremo cliccare.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Nella successiva schermata, selezionare <strong>AWSLambdaBasicExecutionRole</strong> (se non &egrave; immediatamente visualizzato basta cercarlo nel box in cima all'elenco), poi cliccare su <strong>Successivo: Tag</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Nella successiva schermata non c'&egrave; bisogno di modificare alcunch&egrave;, si pu&ograve; direttamente cliccare in basso su <strong>Successivo: Verifica</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>A questo punto, inseriamo come nome ruolo <strong>AWSLambdaBasicExecutionRole-SmartHome</strong>, lasciando pure vuota la descrizione e clicchiamo finalmente su <strong>Crea Ruolo</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Ci siamo quasi, &egrave; il momento di creare la funzione che permette di integrare Home Assistant con Alexa!</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Andiamo nella <a rel="noreferrer noopener" href="https://console.aws.amazon.com/lambda/home" target="_blank">dashboard relativa alle funzioni</a> e clicchiamo su <strong>Crea Funzione</strong>. Proseguiamo con <strong>Crea da zero</strong> e inseriamo un nome (Domotica), scegliamo <strong>Python 3.8</strong> come linguaggio, in <strong>Modifica del ruolo di esecuzione predefinito</strong> scegliamo <strong>Utilizza un ruolo esistente</strong> e selezioniamo quello creato in precedenza.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Clicchiamo su <strong>Crea Funzione</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>A questo punto raggiungiamo <a rel="noreferrer noopener" href="https://developer.amazon.com/alexa/console/ask" target="_blank">questa pagina</a>, clicchiamo su <strong>Crea Skill</strong>, assegnamo un nome, scegliamo Italiano come lingua, <strong>Smart Home</strong> come <strong>Model</strong> e infine <strong>Provision your own</strong>. In alto a destra c'&egrave; il pulsante <strong>Create skill</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Nella successiva schermata scegliamo (se non gi&agrave; selezionata) la <strong>versione 3</strong> del payload e copiate da qualche parte lo <strong>skill-ID</strong> che trovate subito sotto.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Possiamo tornare sulla <a href="https://console.aws.amazon.com/lambda/home" target="_blank" rel="noreferrer noopener">dashboard delle funzioni</a> che abbiamo visto in precedenza e selezionare la funzione Domotica (se l'avete chiamata cos&igrave;), clicchiamo poi su <strong>Aggiungi trigger</strong> e selezioniamo nella schermata successiva <strong>Alexa Smart Home</strong>, inserendo come <strong>ID Applicazione</strong> lo skill-ID che abbiamo copiato al passo precedente, infine clicchiamo su <strong>Aggiungi</strong>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Torneremo indietro di una schermata, basta cliccare su Domotica (vedremo un'icona arancione a sinistra) e in basso, nella scheda <strong>Codice</strong>, bisogner&agrave; cancellare quello che viene proposto e copiare il codice che si trova in <a href="https://gist.githubusercontent.com/matt2005/744b5ef548cc13d88d0569eea65f5e5b/raw/97b018bb12f574e780927c7b8dc85beae3fce6cc/lambda_function.py" target="_blank" rel="noreferrer noopener">questa pagina</a>.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Clicchiamo su <strong>File -> Salva</strong> e poi su <strong>Deploy</strong> (si trova tutto nella scheda Codice), poi andiamo nella scheda <strong>Configurazione -> Modifica -> Aggiungi Variabili d'ambiente</strong>. Dovremo aggiungere le seguenti 4 variabili:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<li><strong>BASE_URL</strong>: https://nomedominio.duckdns.org</li>
<li><strong>DEBUG</strong>: True</li>
<li><strong>NOT_VERIFY_SSL</strong>: True</li>
<li><strong>LONG_LIVED_ACCESS_TOKEN</strong>: il token creato inizialmente su Home Assistant</li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Attenzione perch&egrave; <strong>ad ogni variabile</strong> occorre cliccare su Aggiungi variabile d'ambiente.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Salviamo il tutto e clicchiamo su <strong>Copia ARN</strong> in alto a destra, mettiamo da parte anche questo codice che ci servir&agrave; a breve.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Testiamo ora il tutto, basta cliccare su <strong>Test -> Configure test event -> Crea un nuovo evento di test</strong>. Diamo un nome e inseriamo le seguenti righe di codice:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:syntaxhighlighter/code {"language":"jscript"} --></p>
<pre class="wp-block-syntaxhighlighter-code">{
  "directive": {
    "header": {
      "namespace": "Alexa.Discovery",
      "name": "Discover",
      "payloadVersion": "3",
      "messageId": "1bd5d003-31b9-476f-ad03-71d471922820"
    },
    "payload": {
      "scope": {
        "type": "BearerToken"
      }
    }
  }
}</pre>
<p><!-- /wp:syntaxhighlighter/code --></p>
<p><!-- wp:paragraph --></p>
<p>Clicchiamo su <strong>Crea</strong>, poi su <strong>Test</strong>. Se tutto &egrave; andato bene, la risposta sar&agrave; affermativa.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Torniamo adesso alla <a rel="noreferrer noopener" href="https://developer.amazon.com/alexa/console/ask" target="_blank">console di AWS</a>, selezionando la skill creata in precedenza. Come <strong>Default Endpoint</strong> occorre inserire il codice ARN copiato in precedenza. Salviamo e poi clicchiamo su <strong>Setup Account Linking</strong> in basso, nella schermata successiva compiliamo i campi come segue:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul>
<li><strong>Your Web Authorization URI</strong>: https://nomedominio.duckdns.org/auth/authorize</li>
<li><strong>Access Token URI</strong>: https://nomedominio.duckdns.org/auth/token</li>
<li><strong>Your Client ID</strong>: https://layla.amazon.com</li>
<li><strong>Client Secret</strong>: Home Assistant HDJ</li>
<li><strong>Your Authentication Scheme</strong>: Credentials in request body</li>
<li><strong>Scope</strong>: cliccate su add scope e inserite smart_home</li>
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Lasciate invariato il resto e cliccate su Save.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>A questo punto per integrare Home Assistant con Alexa non resta che collegare il tutto all'app Alexa! Andiamo in <a rel="noreferrer noopener" href="https://alexa.amazon.com/" target="_blank">questa pagina</a>, facciamo il login con le credenziali del nostro dispositivo Alexa, poi su <strong>Skill -> Le tue skill -> Skill per sviluppatori</strong>: dovremmo vedere la skill Domotica che abbiamo creato e, cliccando su <strong>Attiva</strong>, dovrebbe segnalare che la skill &egrave; collegata con successo.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Andando infine su Scopri i dispositivi dovrebbero <strong>magicamente</strong> apparire in lista tutti i dispositivi (per ora solo le luci, ve lo ricordo) gestiti da Home Assistant! Se tutto &egrave; andato bene, siamo riusciti ad integrare Home Assistant con Alexa.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Non resta che limare la configurazione creata per aumentare la sicurezza, torniamo in <a rel="noreferrer noopener" href="https://eu-west-1.console.aws.amazon.com/lambda/home?region=eu-west-1#/functions/Domotica?tab=configuration" target="_blank">questa pagina</a>, e cancelliamo le due variabili d'ambiente DEBUG e LONG_LIVED_ACCESS_TOKEN create in precedenza, non serviranno ulteriormente.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Il token di accesso a lunga vita a questo punto pu&ograve; essere cancellato anche da Home Assistant.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>So che integrare Home Assistant con Alexa pu&ograve; sembrare un processo piuttosto complesso, ma seguendo il tutto con calma vi assicuro che il risultato &egrave; estremamente soddisfacente.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Alla prossima..</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:tadv/classic-paragraph /--></p>


        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/guide/in%20evidenza/raspberry%20pi/domotica/2021/08/01/domotica-automazioni-e-scene-su-home-assistant.html" data-toggle="tooltip" data-placement="top" title="Domotica - Automazioni e scene su Home Assistant">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/tipsntricks/linux/2021/10/17/reinstallare-grub-su-partizione-efi.html" data-toggle="tooltip" data-placement="top" title="Reinstallare GRUB su partizione Efi">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:redblue81@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.facebook.com/angeloredbluepascadopoli">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/angelopascadopoli">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://instagram.com/redblue81">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-instagram fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; RedBlue 2025</p>
      </div>
    </div>
  </div>
</footer>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVMQV0LE9M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LVMQV0LE9M');
</script>

</body>

</html>